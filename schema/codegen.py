#!/usr/bin/env python

schema_files = dict(
  object_ids = 'NodeIds.csv',
  status_codes = 'StatusCode.csv',
)

import csv

def usage():
  print ('''Usage: {0} [cxx|py] [object_ids,status_codes]'''.format(sys.argv[0]))
  raise SystemExit


def cxx_object_ids(fname):
  print('''//
// DO NOT EDIT THIS FILE!
// It is automatically generated from opcfoundation.org schemas.
//

#pragma once

#include <stdint.h>

namespace OpcUa
{
  enum class ObjectID : uint32_t
  {
    Null = 0,''')

  with open(fname) as fd:
    for e in csv.reader(fd, delimiter=','):
      print ('    {0} = {1},'.format(*e[:2]))

  print ('''  };
}
''')

def cxx_status_codes(fname):
  print('''//
// DO NOT EDIT THIS FILE!
// It is automatically generated from opcfoundation.org schemas.
//

#pragma once

#include <stdint.h>

namespace OpcUa
{
  enum class StatusCode : uint32_t
  {
    Good = 0,''')

  with open(fname) as fd:
    for e in csv.reader(fd, delimiter=','):
      print ('    {0} = {1},'.format(*e[:2]))

  print ('''  };

  //raise appropriate exception if StatusCode is not Good
  void CheckStatusCode(StatusCode code);

}
''')


def py_object_ids(fname):
  print('''//
// DO NOT EDIT THIS FILE!
// It is automatically generated from opcfoundation.org schemas.
//

#include <boost/python.hpp>

#include "opc/ua/protocol/object_ids.h"

using namespace boost::python;
using namespace OpcUa;

void py_opcua_enums_ObjectID()
{
  enum_<ObjectID>("ObjectID")
#define _value(X) value(#X, ObjectID:: X)''')

  with open(fname) as fd:
    for e in csv.reader(fd, delimiter=','):
      print ('  ._value({0})'.format(e[0]))

  print ('''#undef _value
  ;
}
''')

def py_status_codes(fname):
  print('''//
// DO NOT EDIT THIS FILE!
// It is automatically generated from opcfoundation.org schemas.
//

#include <boost/python.hpp>

#include "opc/ua/protocol/status_codes.h"

using namespace boost::python;
using namespace OpcUa;

void py_opcua_enums_StatusCode()
{
  enum_<StatusCode>("StatusCode")
#define _value(X) value(#X, StatusCode:: X)''')

  with open(fname) as fd:
    for e in csv.reader(fd, delimiter=','):
      print ('  ._value({0})'.format(e[0]))

  print ('''#undef _value
  ;
}
''')


if __name__ == '__main__':
  import sys
  import os
  
  if len(sys.argv) != 3: usage()
  target, what = sys.argv[1:]
  if target not in ('cxx','py',): usage()
  if what not in ('object_ids','status_codes',): usage()
  call='{0}_{1}'.format(target,what)
  try:
    relpath = os.path.dirname(__file__)
    locals()[call](os.path.join(relpath,schema_files[what]))
  except:
    usage()

